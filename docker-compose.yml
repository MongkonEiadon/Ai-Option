version: '3.4'

services:
  mssql:
    container_name: "aioption_mssql"
    image: "microsoft/mssql-server-linux"
    environment:
        SA_PASSWORD: "Str0ngPassword!"
        ACCEPT_EULA: "Y"    
    healthcheck:
      test: sqlcmd -S db.prod.aioption.com -U SA -P 'Str0ngPassword!' -Q 'select 1'
    ports:
      - 1401:1433    
    networks:
      backend:
        aliases:
          - db.prod.aioption.com

  # eventstore:
  #   container_name: "aioption_eventstore"
  #   image: "eventstore/eventstore"
  #   ports:
  #     - 2113:2113
  #     - 1113:1113
  #   networks:
  #     backend:
  #       aliases:
  #         - es.prod.aioption.com

  # caddy:
  #   container_name: "aioption_caddy"
  #   image: "abiosoft/caddy"
  #   ports:
  #     - 8080:80
  #     - 2015:2015
  #   volumes:
  #     - ./docker/caddy/Caddyfile:/etc/Caddyfile
  #   cap_add:
  #     - NET_BIND_SERVICE


  aioption.webportal:
    container_name: "aioption_webportal"
    image: ${DOCKER_REGISTRY-}aioptionwebportal
    build:
      context: .
      dockerfile: src/App/AiOption.WebPortal.Blazor.Server/Dockerfile
    networks:
      - frontend
    depends_on:
      - mssql

  # aioption.tradings:
  #   container_name: "aioption_tradings"
  #   image: ${DOCKER_REGISTRY-}aioptiontradings
  #   build:
  #     context: .
  #     dockerfile: src/App/AiOption.Tradings/Dockerfile
  #   networks:
  #     - backend
  #   depends_on:
  #     - mssql
      
networks:  
  frontend:
  backend:
